
{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 py-8 px-4">
  <div class="max-w-7xl mx-auto">
    
    <!-- Header Section -->
    <div class="text-center mb-12 fade-in">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl mb-6 shadow-xl">
        <i class="fas fa-user-shield text-3xl text-white"></i>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-4">
        Admin Dashboard
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
        Manage support messages and monitor user activity from this central command center.
      </p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 fade-in">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
            <i class="fas fa-envelope text-yellow-600 text-xl"></i>
          </div>
          <span class="text-sm font-medium text-yellow-600 bg-yellow-100 px-3 py-1 rounded-full">Messages</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ messages|length if messages else 0 }}</h3>
        <p class="text-gray-600">Support Messages</p>
      </div>

      <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 fade-in">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
            <i class="fas fa-users text-blue-600 text-xl"></i>
          </div>
          <span class="text-sm font-medium text-blue-600 bg-blue-100 px-3 py-1 rounded-full">Users</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ users|length if users else 0 }}</h3>
        <p class="text-gray-600">Registered Users</p>
      </div>

      <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 fade-in">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
            <i class="fas fa-clock text-green-600 text-xl"></i>
          </div>
          <span class="text-sm font-medium text-green-600 bg-green-100 px-3 py-1 rounded-full">Pending</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ messages|selectattr("pending")|list|length if messages else 0 }}</h3>
        <p class="text-gray-600">Pending Messages</p>
      </div>
    </div>

    <!-- Support Messages Section -->
    <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8 fade-in">
      <div class="bg-gradient-to-r from-blue-500 to-indigo-600 px-8 py-6">
        <h2 class="text-2xl font-bold text-white flex items-center">
          <i class="fas fa-envelope mr-3"></i>
          Support Messages
        </h2>
        <p class="text-blue-100 mt-2">Click on any row to view detailed message information</p>
      </div>

      <div class="p-6">
        {% if messages %}
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b-2 border-gray-100">
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Customer</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Contact</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Preview</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Status</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for msg in messages %}
              <tr 
                class="border-b border-gray-50 hover:bg-gray-50 transition-all duration-200 cursor-pointer message-row"
                data-name="{{ msg.name }}"
                data-email="{{ msg.email }}"
                data-message="{{ msg.message }}"
                data-pending="{{ msg.pending }}"
                onclick="openMessageModal('{{ msg.name }}', '{{ msg.email }}', '{{ msg.message|e }}', {{ msg.pending|lower }})"
              >
                <td class="py-4 px-6">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center">
                      <span class="text-white font-semibold text-sm">{{ msg.name[0].upper() }}</span>
                    </div>
                    <div>
                      <div class="font-semibold text-gray-900">{{ msg.name }}</div>
                    </div>
                  </div>
                </td>
                <td class="py-4 px-6">
                  <div class="flex items-center text-blue-600">
                    <i class="fas fa-envelope mr-2"></i>
                    <span class="hover:underline">{{ msg.email }}</span>
                  </div>
                </td>
                <td class="py-4 px-6">
                  <div class="text-gray-600 max-w-xs truncate">{{ msg.message[:50] }}{% if msg.message|length > 50 %}...{% endif %}</div>
                </td>
                <td class="py-4 px-6">
                  {% if msg.pending %}
                  <span class="inline-flex items-center px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">
                    <i class="fas fa-clock mr-1"></i>
                    Pending
                  </span>
                  {% else %}
                  <span class="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                    <i class="fas fa-check mr-1"></i>
                    Resolved
                  </span>
                  {% endif %}
                </td>
                <td class="py-4 px-6">
                  <button class="text-blue-600 hover:text-blue-800 transition-colors duration-200">
                    <i class="fas fa-eye"></i>
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-envelope text-gray-400 text-2xl"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No support messages</h3>
          <p class="text-gray-600">Support messages will appear here when customers contact you.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Users Section -->
    <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden fade-in">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 px-8 py-6">
        <h2 class="text-2xl font-bold text-white flex items-center">
          <i class="fas fa-users mr-3"></i>
          Registered Users
        </h2>
        <p class="text-indigo-100 mt-2">Click on any row to view detailed user information</p>
      </div>

      <div class="p-6">
        {% if users %}
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b-2 border-gray-100">
                <th class="text-left py-4 px-6 font-semibold text-gray-700">User</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Contact</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Business</th>
                <th class="text-left py-4 px-6 font-semibold text-gray-700">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
              <tr 
                class="border-b border-gray-50 hover:bg-gray-50 transition-all duration-200 cursor-pointer user-row"
                onclick="openUserModal('{{ user.first_name }}', '{{ user.last_name }}', '{{ user.email }}', '{{ user.business }}')"
              >
                <td class="py-4 px-6">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-full flex items-center justify-center">
                      <span class="text-white font-semibold text-sm">{{ user.first_name[0].upper() }}{{ user.last_name[0].upper() }}</span>
                    </div>
                    <div>
                      <div class="font-semibold text-gray-900">{{ user.first_name }} {{ user.last_name }}</div>
                    </div>
                  </div>
                </td>
                <td class="py-4 px-6">
                  <div class="flex items-center text-indigo-600">
                    <i class="fas fa-envelope mr-2"></i>
                    <span class="hover:underline">{{ user.email }}</span>
                  </div>
                </td>
                <td class="py-4 px-6">
                  <div class="text-gray-600">{{ user.business }}</div>
                </td>
                <td class="py-4 px-6">
                  <button class="text-indigo-600 hover:text-indigo-800 transition-colors duration-200">
                    <i class="fas fa-eye"></i>
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-users text-gray-400 text-2xl"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No registered users</h3>
          <p class="text-gray-600">User accounts will appear here when people sign up.</p>
        </div>
        {% endif %}
      </div>
    </div>

  </div>
</div>

<!-- Message Details Modal -->
<div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold text-gray-900 flex items-center">
        <i class="fas fa-envelope text-blue-500 mr-3"></i>
        Support Message Details
      </h3>
      <button onclick="closeMessageModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <div class="space-y-6">
      <!-- Customer Info -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
          <i class="fas fa-user text-blue-500 mr-2"></i>
          Customer Information
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-600">Name</label>
            <div id="modalCustomerName" class="text-lg font-semibold text-gray-900"></div>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-600">Email</label>
            <div id="modalCustomerEmail" class="text-lg text-blue-600"></div>
          </div>
        </div>
      </div>

      <!-- Status -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
          <i class="fas fa-info-circle text-blue-500 mr-2"></i>
          Status
        </h4>
        <div id="modalStatus"></div>
      </div>

      <!-- Message Content -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
          <i class="fas fa-comment text-blue-500 mr-2"></i>
          Message Content
        </h4>
        <div id="modalMessageContent" class="text-gray-700 leading-relaxed bg-white p-4 rounded-lg border"></div>
      </div>

      <!-- Actions -->
      <div class="flex gap-3 pt-4">
        <button onclick="closeMessageModal()" class="flex-1 btn-secondary">
          Close
        </button>
        <button onclick="markAsResolved()" class="flex-1 btn-primary" id="resolveBtn">
          <i class="fas fa-check mr-2"></i>
          Mark as Resolved
        </button>
      </div>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold text-gray-900 flex items-center">
        <i class="fas fa-user text-indigo-500 mr-3"></i>
        User Details
      </h3>
      <button onclick="closeUserModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <div class="space-y-6">
      <!-- User Info -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
          <i class="fas fa-id-card text-indigo-500 mr-2"></i>
          Personal Information
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-600">First Name</label>
            <div id="modalUserFirstName" class="text-lg font-semibold text-gray-900"></div>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-600">Last Name</label>
            <div id="modalUserLastName" class="text-lg font-semibold text-gray-900"></div>
          </div>
        </div>
      </div>

      <!-- Contact Info -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
          <i class="fas fa-envelope text-indigo-500 mr-2"></i>
          Contact Information
        </h4>
        <div>
          <label class="text-sm font-medium text-gray-600">Email Address</label>
          <div id="modalUserEmail" class="text-lg text-indigo-600"></div>
        </div>
      </div>

      <!-- Business Info -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
          <i class="fas fa-building text-indigo-500 mr-2"></i>
          Business Information
        </h4>
        <div>
          <label class="text-sm font-medium text-gray-600">Business Name</label>
          <div id="modalUserBusiness" class="text-lg text-gray-900"></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex gap-3 pt-4">
        <button onclick="closeUserModal()" class="flex-1 btn-secondary">
          Close
        </button>
        <button onclick="contactUser()" class="flex-1 btn-primary">
          <i class="fas fa-envelope mr-2"></i>
          Contact User
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Message Modal Functions
function openMessageModal(name, email, message, pending) {
  document.getElementById('modalCustomerName').textContent = name;
  document.getElementById('modalCustomerEmail').textContent = email;
  document.getElementById('modalMessageContent').textContent = message;
  
  const statusElement = document.getElementById('modalStatus');
  const resolveBtn = document.getElementById('resolveBtn');
  
  if (pending) {
    statusElement.innerHTML = `
      <span class="inline-flex items-center px-3 py-2 bg-yellow-100 text-yellow-800 text-sm font-medium rounded-full">
        <i class="fas fa-clock mr-2"></i>
        Pending Response
      </span>
    `;
    resolveBtn.style.display = 'block';
  } else {
    statusElement.innerHTML = `
      <span class="inline-flex items-center px-3 py-2 bg-green-100 text-green-800 text-sm font-medium rounded-full">
        <i class="fas fa-check mr-2"></i>
        Resolved
      </span>
    `;
    resolveBtn.style.display = 'none';
  }
  
  document.getElementById('messageModal').classList.remove('hidden');
}

function closeMessageModal() {
  document.getElementById('messageModal').classList.add('hidden');
}

function markAsResolved() {
  // Add functionality to mark message as resolved
  alert('Message marked as resolved!');
  closeMessageModal();
}

// User Modal Functions
function openUserModal(firstName, lastName, email, business) {
  document.getElementById('modalUserFirstName').textContent = firstName;
  document.getElementById('modalUserLastName').textContent = lastName;
  document.getElementById('modalUserEmail').textContent = email;
  document.getElementById('modalUserBusiness').textContent = business;
  
  document.getElementById('userModal').classList.remove('hidden');
}

function closeUserModal() {
  document.getElementById('userModal').classList.add('hidden');
}

function contactUser() {
  const email = document.getElementById('modalUserEmail').textContent;
  window.location.href = `mailto:${email}`;
}

// Close modals when clicking outside
document.getElementById('messageModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeMessageModal();
  }
});

document.getElementById('userModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeUserModal();
  }
});

// Add fade-in animation
document.addEventListener('DOMContentLoaded', function() {
  const elements = document.querySelectorAll('.fade-in');
  elements.forEach((el, index) => {
    setTimeout(() => {
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }, index * 100);
  });
});
</script>

<style>
.fade-in {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s ease-out;
}

.message-row:hover,
.user-row:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-primary {
  @apply bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center;
}

.btn-secondary {
  @apply bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center;
}
</style>
{% endblock %}
